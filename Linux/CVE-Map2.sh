#!/bin/bash

# Script to parse CVE to MS: Mapping
# Data scraped from: https://cve.mitre.org/data/refs/refmap/source-MS.html

# Prep WES.out from systeminfo results
#		Ex: wes systeminfo.txt -i "Remote Code Execution" > WES.out
# Prep CVE.out from WES.out 
#		Ex: echo $(cat WES.out| grep CVE | awk '/CVE/ {print $2}')

cat WES.out| grep CVE | awk '/CVE/ {print $2}'| uniq > CVE.out

echo "Performing Lookup This may Take Some Time..."
while IFS= read -r line; do
    curl -s https://cve.mitre.org/data/refs/refmap/source-MS.html | grep -B1 $line | awk '/MS/ {print $1}' | sed -e 's/<[^>]*>//g' >> .CVE.tmp
    echo "..... Conducting Next Lookup"
done < CVE.out

echo "Cleaning Up Data"
cat .CVE.tmp | sort | uniq > CVE.map
rm .CVE.tmp
echo "Results Ready In CVE.map"
